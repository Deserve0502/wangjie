"use strict";var shopArr=new Array,ls=localStorage;function loadGoods(){myAjax({type:"get",url:"./PHP/shopcar_show.php",date:{user_id:ls.getItem("userid")},success:function(e){for(var n=JSON.parse(e),o="",r=0;r<n.length;r++)o+='<li class="goods_list">\n                        <span class="iconfont chose">&#xe641;</span>\n                        <span class="iconfont is">&#xe605;</span>\n                        <div class="goods_img">'+n[r].image+'</div>\n                        <div class="goods_Intro">\n                        <p class="intro">'+n[r].name+'</p>\n                        <p class="spec">22222</p>\n                        </div>\n                          <div class="subprice">￥<span class="price">'+n[r].price+'</span></div> \n                            <div class="number">\n                                <button class="reduce">-</button>\n                                <span class="num">'+n[r].count+'</span>\n                                <button class="add">+</button>\n                            </div>\n                            <div >￥<span class="price_total">'+n[r].price*n[r].count+'</span></div>\n                            <div class="opt">\n                                <p>收藏<span class="iconfont favorites">&#xe601;</span></p>\n                                <p>删除<span class="iconfont delete">&#xe73f;</span></p>\n                            </div>\n                        </li>',shopArr.push(n[r].goods_id);$(".show").html(o),getAdd(),getRedu(),del(),totalPrice(),totalNumber(),chose(),notchose(),choseAll(),chose_notall_check(),chose_delete()}})}function getAdd(){for(var e=document.querySelectorAll(".add"),n=0;n<e.length;n++)!function(o){e[o].onclick=function(){myAjax({method:"post",url:"./PHP/shopcar_insert.php",date:{goods_id:shopArr[o],user_id:ls.getItem("userid")},success:function(e){var n=JSON.parse(e);2==n.code&&alert("添加失败"),3==n.code&&(numberAdd(o),Subtotal(o),totalPrice(),totalNumber())},error:function(e){alert(e)}})}}(n)}function getRedu(){for(var e=document.querySelectorAll(".reduce"),n=0;n<e.length;n++)!function(o){e[o].onclick=function(){myAjax({method:"post",url:"./PHP/shopcar_reduce.php",date:{goods_id:shopArr[o],user_id:ls.getItem("userid")},success:function(e){var n=JSON.parse(e);2==n.code&&alert("添加失败"),3==n.code&&(numberRedu(o),Subtotal(o),totalPrice(),totalNumber())},error:function(e){alert(e)}})}}(n)}function delGoods(e){document.querySelectorAll(".reduce");myAjax({method:"post",url:"./PHP/shopcar_delete.php",date:{goods_id:shopArr[e],user_id:ls.getItem("userid")},success:function(e){var n=JSON.parse(e);2==n.code&&alert("删除失败"),3==n.code&&location.reload()},error:function(e){alert(e)}})}function numberAdd(e){var n=document.querySelectorAll(".num");n[e].innerHTML=Number(n[e].innerHTML)+1}function numberRedu(e){var n=document.querySelectorAll(".num");0<n[e].innerHTML?n[e].innerHTML=n[e].innerHTML-1:delGoods(e)}function del(){for(var n=document.querySelectorAll(".delete"),e=0;e<n.length;e++)!function(e){n[e].onclick=function(){confirm("确定要删除吗？")&&delGoods(e)}}(e)}function Subtotal(e){var n=document.querySelectorAll(".price_total"),o=document.querySelectorAll(".num"),r=document.querySelectorAll(".price");n[e].innerHTML=o[e].innerHTML*r[e].innerHTML}function totalPrice(){for(var e=document.querySelector(".total_Price"),n=document.querySelectorAll(".price_total"),o=e.innerHTML=0;o<n.length;o++)e.innerHTML=Number(n[o].innerHTML)+Number(e.innerHTML);for(var r=0;r<notchoseArr.length;r++)e.innerHTML=Number(e.innerHTML)-Number(n[notchoseArr[r]].innerHTML)}function totalNumber(){for(var e=document.querySelector(".chose_num"),n=document.querySelectorAll(".num"),o=e.innerHTML=0;o<n.length;o++)e.innerHTML=Number(n[o].innerHTML)+Number(e.innerHTML);for(var r=0;r<notchoseArr.length;r++)e.innerHTML=Number(e.innerHTML)-Number(n[notchoseArr[r]].innerHTML)}loadGoods();var notchoseArr=new Array,notchoseitem=void 0,choseArr=new Array;function notchose(){for(var n=document.querySelectorAll(".chose"),o=document.querySelectorAll(".price_total"),r=document.querySelector(".total_Price"),t=document.querySelector(".chose_num"),c=document.querySelectorAll(".num"),e=0;e<n.length;e++)!function(e){n[e].onclick=function(){notchoseArr.push(e),notchoseitem=Array.from(new Set(notchoseArr)),notchoseArr=notchoseitem,n[e].style.display="none",r.innerHTML=r.innerHTML-o[e].innerHTML,t.innerHTML=t.innerHTML-c[e].innerHTML}}(e)}function chose(){for(var e=document.querySelectorAll(".is"),o=document.querySelectorAll(".chose"),r=document.querySelectorAll(".price_total"),t=document.querySelector(".total_Price"),c=document.querySelector(".chose_num"),l=document.querySelectorAll(".num"),n=0;n<e.length;n++)!function(n){e[n].onclick=function(){notchoseArr=notchoseArr.filter(function(e){return e!=n}),o[n].style.display="block",t.innerHTML=Number(t.innerHTML)+Number(r[n].innerHTML),c.innerHTML=Number(c.innerHTML)+Number(l[n].innerHTML)}}(n)}function choseAll(){$(".chose_all").click(function(){var e=0,n=0;$(".chose").show(),$(".check").show();for(var o=0;o<r.length;o++)e=Number(e)+Number(r[o].innerHTML),n=Number(n)+Number(t[o].innerHTML);$(".total_Price").html(e),$(".chose_num").html(n),notchoseArr.length=0});var r=document.querySelectorAll(".price_total"),t=document.querySelectorAll(".num")}function chose_notall_check(){$(".check").click(function(){for(var e=$(".show").find("li"),n=0;n<e.length;n++)notchoseArr.push(n);console.log(notchoseArr),$(".check").hide(),$(".chose").hide(),$(".total_Price").html(0),$(".chose_num").html(0)})}function chose_delete(){document.querySelector(".chose_delete").onclick=function(){for(var e=$(".show").find("li"),n=0;n<e.length;n++)choseArr.push(n);for(var o=0;o<notchoseArr.length;o++)!function(n){choseArr=choseArr.filter(function(e){return e!=notchoseArr[n]})}(o);if(confirm("你确定要删除吗？"))for(var r=0;r<choseArr.length;r++)delGoods(choseArr[r])}}