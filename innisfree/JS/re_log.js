"use strict";var omask=document.querySelector(".mask"),obutton_login=document.querySelector(".button_login"),obutton_regist=document.querySelector(".button_regist"),oregist=document.querySelector(".regist"),ologin=document.querySelector(".login"),ose_seOrme=document.querySelector(".se_seOrme"),ose_seOrme_span=ose_seOrme.querySelectorAll("span"),ose_login=document.querySelector(".se_login"),ome_login=document.querySelector(".me_login"),oexit=document.querySelectorAll(".exit"),oreturn=document.querySelectorAll(".return"),oretrieve=document.querySelector(".retrieve"),oret_em=document.querySelector(".ret_em"),ose_phOrem=document.querySelector(".se_phOrem"),ose_phOrem_span=ose_phOrem.querySelectorAll("span"),ofd_meOrRes=document.querySelector(".fd_meOrRes"),ofd_meOrRes_span=ofd_meOrRes.querySelectorAll("span"),ofd_res=document.querySelector(".fd_res"),ofd_res_span=ofd_res.querySelector("span"),ores_username=document.querySelector(".res_username"),ore_pwd_1=document.querySelector(".re_pwd_1"),ore_pwd_2=document.querySelector(".re_pwd_2"),ores_birthday=document.querySelector(".res_birthday"),ores_ph_same=document.querySelector(".res_ph_same"),ores_read=document.querySelector(".res_read");ose_seOrme_span[0].style.backgroundColor="#024137",ose_seOrme_span[0].style.color="white",ose_phOrem_span[0].style.backgroundColor="#024137",ose_phOrem_span[0].style.color="white",ose_seOrme.onclick=function(e){for(var o=(e||window.event).target||window.event.srcElement,t=0;t<ose_seOrme_span.length;t++)ose_seOrme_span[t].style.backgroundColor="white",ose_seOrme_span[t].style.color="#024137";o.style.backgroundColor="#024137",o.style.color="white"},ose_phOrem.onclick=function(e){for(var o=(e||window.event).target||window.event.srcElement,t=0;t<ose_phOrem_span.length;t++)ose_phOrem_span[t].style.backgroundColor="white",ose_phOrem_span[t].style.color="#024137";o.style.backgroundColor="#024137",o.style.color="white"},ose_seOrme_span[0].onclick=function(){ome_login.style.display="none",ose_login.style.display="block",ologin.style.height="415px"},ose_phOrem_span[0].onclick=function(){oret_em.style.display="none",oret_ph.style.display="block"},ose_phOrem_span[1].onclick=function(){oret_em.style.display="block",oret_ph.style.display="none"},ose_seOrme_span[1].onclick=function(){ose_login.style.display="none",ome_login.style.display="block",ome_login.style.height="313px",ologin.style.height="459px"};for(var i=0;i<oexit.length;i++)oexit[i].onclick=function(){omask.style.display="none"};obutton_login.onclick=function(){omask.style.display="block",oregist.style.display="none",ologin.style.display="block",oretrieve.style.display="none"},obutton_regist.onclick=function(){omask.style.display="block",ologin.style.display="none",oregist.style.display="block",oretrieve.style.display="none"};for(var _i=0;_i<oreturn.length;_i++)oreturn[_i].onclick=function(){oregist.style.display="none",ologin.style.display="block",oretrieve.style.display="none"};ofd_meOrRes_span[0].onclick=function(){oretrieve.style.display="block",ologin.style.display="none"},ofd_meOrRes_span[1].onclick=function(){oretrieve.style.display="none",ologin.style.display="none",oregist.style.display="block"},ofd_res_span.onclick=function(){oregist.style.display="block",oretrieve.style.display="none",ologin.style.display="none"};var ores_btn=document.querySelector(".res_btn"),ores_btn_input=oregist.querySelectorAll("input"),flagtel=!1,flagpwd=!1,flagname=!1,flagbir=!1,flagread=!1,regNum=/^\d+$/,regLetter=/^[a-zA-Z]+$/,regChar=/^[!@#$.]+$/,_regNum=/\d+/,_regLetter=/[a-zA-Z]+/,_regChar=/[!@#$.]+/;ores_btn_input[1].onblur=function(){/^1(3|4|5|6|7|8|9)\d{9}$/.test(this.value)?(ores_ph_same.innerHTML="",myAjax({method:"post",url:"./PHP/regist_ph_same.php",date:{res_name:ores_btn_input[1].value},success:function(e){var o=JSON.parse(e);4==o.code&&(ores_ph_same.innerHTML="此电话号码已被注册",flagtel=!1),1==o.code&&(ores_ph_same.innerHTML="",flagtel=!0)}})):(ores_ph_same.innerHTML="请输入正确的手机格式",flagtel=!1)},ores_btn_input[3].onblur=function(){flagpwd=/^[0-9a-zA-Z\u0000-\u00FF]{6,16}$/.test(this.value)?(regNum.test(this.value)||regLetter.test(this.value)||regChar.test(this.value)?ore_pwd_1.innerHTML="强度弱":_regNum.test(this.value)&&_regLetter.test(this.value)&&_regChar.test(this.value)?ore_pwd_1.innerHTML="强度强":ore_pwd_1.innerHTML="强度中等",!0):(ores_btn_input[3].value.length<6?ore_pwd_1.innerHTML="请输入至少长度为6位的密码":ore_pwd_1.innerHTML="请输入英文与数字或者半角符号混合的6-16位密码",!1)},ores_btn_input[4].onblur=function(){ores_btn_input[4].value!=ores_btn_input[3].value?(ore_pwd_2.innerHTML="两次密码不一致",flagpwd=!1):ore_pwd_2.innerHTML=""},ores_btn_input[5].onblur=function(){6<ores_btn_input[5].value.length?(ores_username.innerHTML="请输入长度小于6位的用户名",flagname=!1):(ores_btn_input[5].value.length<6&&(ores_username.innerHTML=""),myAjax({method:"post",url:"./PHP/regist_same.php",date:{res_name:ores_btn_input[5].value},success:function(e){var o=JSON.parse(e);4==o.code&&(ores_username.innerHTML="用户名已经被创建",flagname=!1),1==o.code&&(ores_username.innerHTML="",flagname=!0)}}))},ores_btn_input[6].onblur=function(){flagbir=/^\d{4}[-]\d{2}[-]\d{2}$/.test(this.value)?!(ores_birthday.innerHTML=""):!(ores_birthday.innerHTML="请输入正确的日期格式：例如1999-01-01")},ores_btn_input[7].onclick=function(){1==ores_btn_input[7].checked?(flagread=!0,ores_read.innerHTML=""):0==ores_btn_input[7].checked&&(flagread=!1,ores_read.innerHTML="请勾选")},ores_btn.onclick=function(){if(0==flagread&&(ores_read.innerHTML="请勾选"),1==flagbir&&1==flagtel&&1==flagpwd&&1==flagname&&1==flagread){var e=new Date,o=e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate();myAjax({method:"post",url:"./PHP/regist.php",date:{res_tel:ores_btn_input[1].value,res_pwd:ores_btn_input[4].value,res_name:ores_btn_input[5].value,res_bir:ores_btn_input[6].value,addTime:o},success:function(e){var o=JSON.parse(e);2==o.code&&alert("创建失败,所有星号为必填项"),3==o.code&&alert("创建成功！")},error:function(e){alert(e)}});for(var t=0;t<ores_btn_input.length;t++)ores_btn_input[t].value=null;ores_btn_input[7].checked=!1,setTimeout(function(){oregist.style.display="none",ologin.style.display="block",oretrieve.style.display="none"},2e3)}else alert("请确认所填项是否格式正确")};var ose_login_input=ose_login.querySelectorAll("input"),olog_btn=document.querySelector(".log_btn");olog_btn.onclick=function(){myAjax({method:"post",url:"./PHP/login_ph.php",date:{log_tel:Number(ose_login_input[0].value),log_pwd:ose_login_input[1].value},success:function(e){var o=JSON.parse(e);2==o.code?alert("登陆失败"):(alert("登陆成功"),ls.setItem("userid",o[0].userId),ls.setItem("username",o[0].userName),location.reload(),omask.style.display="none")}})};var oret_ph=document.querySelector(".ret_ph"),oret_ph_pwd=document.querySelector(".ret_ph_pwd"),oret_ph_input=oret_ph.querySelectorAll("input"),oret_ph_btn=document.querySelector(".ret_ph_btn"),flag_ret_pwd=!(oret_ph_btn.onclick=function(){if(1==flag_ret_pwd){myAjax({method:"get",url:"./PHP/ret_ph.php",date:{tel:oret_ph_input[0].value,pwd:oret_ph_input[4].value},success:function(e){3==JSON.parse(e).code?(alert("修改成功"),setTimeout(function(){oregist.style.display="none",ologin.style.display="block",oretrieve.style.display="none"},1e3)):alert("修改失败")}});for(var e=0;e<oret_ph_input.length;e++)oret_ph_input[e].value=null}else alert("请确认所填项是否格式正确")});oret_ph_input[4].onblur=function(){flag_ret_pwd=oret_ph_input[4].value!=oret_ph_input[3].value?!(oret_ph_pwd.innerHTML="两次密码不一致"):!(oret_ph_pwd.innerHTML="")},window.addEventListener("scroll",function(){var e=document.body.scrollTop||document.documentElement.scrollTop;omask.style.marginTop=e+"px",omask.style.left=0});